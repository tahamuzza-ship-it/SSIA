<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>HYDRA War-Room</title>
  <style>
    :root{--bg:#0f1220;--card:#1a1f36;--border:#2e3650;--text:#e6e8f0;--muted:#aab2cf}
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial,sans-serif;margin:0;padding:24px;background:var(--bg);color:var(--text)}
    h1{margin:0 0 16px 0;font-size:22px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;box-shadow:0 6px 20px rgba(0,0,0,.2)}
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px;margin-left:6px;border:1px solid transparent}
    .ok{background:#153f2d;color:#90e6b5;border-color:#245c43}
    .err{background:#3f1521;color:#f3a5b5;border-color:#6a2132}
    .pending{background:#3a3218;color:#f1e0a3;border-color:#5e5122}
    code, pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:12px;white-space:pre-wrap;word-break:break-word}
    .muted{color:var(--muted)}
    details{margin-top:12px}
    .kpis{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .kpi{background:rgba(255,255,255,0.03);border:1px dashed var(--border);padding:8px 10px;border-radius:10px}
    a{color:#9ecbff}
  </style>
</head>
<body>
  <h1>üõ°Ô∏è HYDRA War-Room</h1>
  <div class="grid" id="cards"></div>
  <footer class="muted" style="margin-top:24px">Datos en vivo desde GitHub JSON.</footer>

<script>
// JSON RAW en tu GitHub (simple y correcto)
const DATA_URL = "https://raw.githubusercontent.com/tahamuzza-ship-it/SSIA/main/dashboard.json";

function badge(status){
  if(status==="success") return '<span class="pill ok">OK</span>';
  if(status==="error") return '<span class="pill err">ERROR</span>';
  return '<span class="pill pending">PENDIENTE</span>';
}
function kv(obj, k=5){
  if(!obj || typeof obj!=='object') return [];
  return Object.keys(obj).slice(0,k).map(key => `${key}: ${String(obj[key]).slice(0,80)}`);
}

async function render(){
  const wrap = document.getElementById('cards');
  wrap.innerHTML = "<div class='card'>Cargando datos‚Ä¶</div>";
  try{
    const resp = await fetch(DATA_URL, {cache:"no-store"});
    const raw = await resp.json();
    const list = Array.isArray(raw) ? raw : [raw];
    wrap.innerHTML = "";

    list.forEach((item, i) => {
      const status = item.status || (item.error ? "error" : (item.pending ? "pending" : "success"));
      const message = item.message || item.descripcion || "Datos cargados";
      const meta = item.data || item.details || item;
      const pretty = JSON.stringify(item, null, 2);

      const html = `
        <div class="card">
          <div style="display:flex;align-items:center;justify-content:space-between;">
            <div><strong>Registro ${i+1}</strong> ${badge(status)}</div>
          </div>
          <div class="muted" style="margin-top:8px">${message}</div>
          <div class="kpis">${kv(meta,5).map(x=>`<span class="kpi"><code>${x}</code></span>`).join('')}</div>
          <details><summary>Ver JSON</summary><pre><code>${pretty}</code></pre></details>
        </div>`;
      wrap.insertAdjacentHTML('beforeend', html);

      if (Array.isArray(item.incidentes)) {
        const rows = item.incidentes.slice(0,5).map(r =>
          `<li><code>${r.id}</code> ‚Ä¢ ${r.sev} ‚Ä¢ ${r.estado} ‚Äî ${r.titulo}</li>`).join('');
        wrap.insertAdjacentHTML('beforeend', `<div class="card"><strong>Incidentes</strong><ul>${rows}</ul></div>`);
      }
      if (Array.isArray(item.accounts)) {
        const rows = item.accounts.slice(0,5).map(r =>
          `<li>${r.nombre} ‚Äî impacto: <code>${r.impacto}</code></li>`).join('');
        wrap.insertAdjacentHTML('beforeend', `<div class="card"><strong>Accounts</strong><ul>${rows}</ul></div>`);
      }
    });

    if(!list.length){
      wrap.innerHTML = "<div class='card'>No hay registros en el JSON.</div>";
    }
  }catch(e){
    console.error(e);
    wrap.innerHTML = "<div class='card'><strong>Error</strong>: No pude leer el JSON de GitHub.</div>";
  }
}
render();
</script>
</body>
</html>
