<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Artes Marciales Tahamuuzza - Clases 150 a 192</title>

    <!-- LibrerÃ­as -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <link href="https://unpkg.com/tabulator-tables@5.4.1/dist/css/tabulator.min.css" rel="stylesheet" />
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@5.4.1/dist/js/tabulator.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a1a;
            color: #E8E8E8;
            line-height:1.6;
        }
        .tatami-pattern {
            position: fixed; top:0; left:0; width:100%; height:100%;
            opacity:0.03;
            background-image: repeating-linear-gradient(45deg, transparent, transparent 35px, #E8E8E8 35px, #E8E8E8 70px);
            pointer-events:none; z-index:0;
        }
        .container { position:relative; z-index:1; max-width:1400px; margin:0 auto; padding:40px 20px; }

        .header {
            text-align:center; padding:60px 40px; margin-bottom:50px;
            background: linear-gradient(135deg, rgba(220,20,60,0.15) 0%, rgba(45,80,22,0.15) 100%);
            border-left:8px solid #DC143C; border-right:8px solid #2D5016;
            position:relative; overflow:hidden;
        }
        .header::before {
            content:''; position:absolute; top:0; left:0; right:0; height:3px;
            background: linear-gradient(90deg, #DC143C, #FFD700, #2D5016);
        }
        .header h1 {
            font-family:'Playfair Display', serif; font-size:56px; font-weight:900; color:#DC143C;
            margin-bottom:10px; letter-spacing:-2px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        .header p { font-size:20px; color:#FFD700; font-weight:600; letter-spacing:2px; text-transform:uppercase; }
        .header .subtitle { font-size:14px; color:#81C784; margin-top:10px; letter-spacing:1px; }

        .stats-section { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; margin-bottom:50px; }
        .stat-box {
            background:linear-gradient(135deg, rgba(45,80,22,0.2) 0%, rgba(220,20,60,0.1) 100%);
            border:2px solid #FFD700; padding:25px; text-align:center; position:relative; overflow:hidden;
        }
        .stat-box::before { content:''; position:absolute; top:0; left:0; right:0; height:3px; background-color:#DC143C; }
        .stat-number { font-family:'Playfair Display', serif; font-size:48px; font-weight:900; color:#FFD700; margin-bottom:10px; }
        .stat-label { font-size:13px; color:#E8E8E8; text-transform:uppercase; letter-spacing:1px; font-weight:600; }

        .charts-section { display:grid; grid-template-columns:repeat(auto-fit,minmax(350px,1fr)); gap:30px; margin-bottom:50px; }
        .chart-card { background:linear-gradient(135deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.03) 100%); border:1px solid rgba(255,215,0,0.3); padding:30px; border-radius:4px; position:relative; overflow:hidden; }
        .chart-card::before { content:''; position:absolute; top:0; left:0; right:0; height:3px; background:linear-gradient(90deg,#DC143C,#FFD700); }
        .chart-card h3 { font-family:'Playfair Display', serif; font-size:24px; color:#DC143C; margin-bottom:20px; padding-bottom:15px; border-bottom:2px solid #2D5016; }

        .table-section { margin-bottom:50px; }
        .table-section h2 { font-family:'Playfair Display', serif; font-size:32px; color:#DC143C; margin-bottom:20px; padding-bottom:15px; border-bottom:3px solid #FFD700; }

        .filter-controls { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:15px; margin-bottom:25px; padding:20px; background:rgba(45,80,22,0.1); border-left:4px solid #2D5016; }
        .filter-group { display:flex; flex-direction:column; gap:8px; }
        .filter-group label { font-size:13px; color:#FFD700; font-weight:600; text-transform:uppercase; letter-spacing:1px; }
        .filter-group input, .filter-group select { padding:10px 12px; background-color:rgba(255,255,255,0.08); border:1px solid #FFD700; color:#E8E8E8; font-size:14px; border-radius:3px; }
        .filter-buttons { display:flex; gap:10px; align-items:flex-end; }
        .btn { padding:10px 20px; background-color:#DC143C; color:#fff; border:none; border-radius:3px; font-weight:600; cursor:pointer; font-size:13px; text-transform:uppercase; letter-spacing:1px; }
        .btn.secondary { background-color:#2D5016; }
        .btn:hover { background-color:#FFD700; color:#1a1a1a; transform:translateY(-2px); box-shadow:0 4px 12px rgba(255,215,0,0.3); }

        /* Tabulator tweaks */
        .tabulator { background-color:transparent; border:none; }
        .tabulator .tabulator-header { background-color: rgba(220,20,60,0.2); border-bottom:2px solid #FFD700; }
        .tabulator .tabulator-row { background-color: rgba(255,255,255,0.03); border-bottom:1px solid rgba(255,255,255,0.08); }
        .tabulator .tabulator-row .tabulator-cell { color:#E8E8E8; padding:12px; font-size:14px; }

        .footer { text-align:center; padding:40px; border-top:3px solid #FFD700; margin-top:50px; background:linear-gradient(135deg, rgba(220,20,60,0.1) 0%, rgba(45,80,22,0.1) 100%); color:#81C784; font-size:13px; }

        @media (max-width:768px) {
            .header h1 { font-size:36px; }
            .charts-section { grid-template-columns:1fr; }
            .filter-controls { grid-template-columns:1fr; }
        }
    </style>
</head>
<body>
    <div class="tatami-pattern"></div>

    <div class="container">
        <div class="header">
            <h1>ðŸ¥‹ Dashboard Artes Marciales Tahamuuzza ðŸ¥‹</h1>
            <p>Clases 150 a 192</p>
            <div class="subtitle">Repositorio Interactivo de Contenido Educativo</div>
        </div>

        <div class="stats-section" id="statsContainer"></div>

        <div class="charts-section">
            <div class="chart-card">
                <h3>ðŸ“Š DistribuciÃ³n por Plataforma</h3>
                <div class="chart-container"><canvas id="platformChart"></canvas></div>
            </div>

            <div class="chart-card">
                <h3>ðŸ“ˆ Contenido por Clase</h3>
                <div class="chart-container"><canvas id="classCountChart"></canvas></div>
            </div>

            <div class="chart-card">
                <h3>ðŸŽ¯ Clases Ãšnicas por Plataforma</h3>
                <div class="chart-container"><canvas id="platformClassesChart"></canvas></div>
            </div>
        </div>

        <div class="table-section">
            <h2>ðŸ“‹ Contenido Completo</h2>

            <div class="filter-controls">
                <div class="filter-group">
                    <label for="classFilter">Filtrar por Clase:</label>
                    <select id="classFilter"><option value="">Todas las clases</option></select>
                </div>

                <div class="filter-group">
                    <label for="platformFilter">Filtrar por Plataforma:</label>
                    <select id="platformFilter"><option value="">Todas las plataformas</option></select>
                </div>

                <div class="filter-group">
                    <label for="searchInput">Buscar en tÃ­tulos:</label>
                    <input type="text" id="searchInput" placeholder="Escribe aquÃ­..." />
                </div>

                <div class="filter-buttons">
                    <button class="btn" onclick="applyFilters()">Filtrar</button>
                    <button class="btn secondary" onclick="clearFilters()">Limpiar</button>
                </div>
            </div>

            <div id="dataTable"></div>
        </div>

        <div class="footer">
            <p><strong>Dashboard Artes Marciales Tahamuuzza</strong></p>
            <p>Clases 150 a 192 | AnÃ¡lisis de Contenido Educativo</p>
            <p>Creado con HTML5, CSS3, JavaScript, Chart.js, D3.js, Tabulator.js</p>
        </div>
    </div>

    <script>
        /* Datos embebidos (si prefieres usar CSV externo, reemplaza esta parte) */
        const DATA_CSV = `class_number,title,url,platform,notes
192,Liquido medular.,https://youtu.be/7MJuSx142TI?si=9ossuRHzQTNW3i3F,YouTube,
192,Habilidades basicas.,https://www.facebook.com/share/r/1A6avgNUi3/,Facebook,
191,New kick training.,https://www.facebook.com/share/r/1GU8EtuGWH/,Facebook,
191,Baiji training.,https://www.facebook.com/share/r/16TvuqiPKf/,Facebook,
191,Flexiones Rusas.,https://youtube.com/shorts/tVN4XNIyv3Q?si=fPCcJXgnagpP_fG3,YouTube Shorts,
190,9 palacios.,https://youtube.com/watch?v=uBRweMGxUXU&feature=shared,YouTube
`; /* -- truncado en esta copia por brevedad; en tu archivo pega todo el CSV que tengas */

        let allData = [];
        let table = null;

        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',');
            const data = [];
            for (let i = 1; i < lines.length; i++) {
                const currentLine = lines[i].split(',');
                const obj = {};
                for (let j = 0; j < headers.length; j++) {
                    obj[headers[j].trim()] = currentLine[j] ? currentLine[j].trim() : '';
                }
                data.push(obj);
            }
            return data;
        }

        function loadData() {
            allData = parseCSV(DATA_CSV);
            // defensive cleanup: ensure platform and class_number exist
            allData = allData.map(r => ({ class_number: r.class_number || '', title: r.title || '', url: r.url || '', platform: r.platform || 'Desconocida', notes: r.notes || '' }));

            const platformCounts = {};
            const classCounts = {};
            const platformClasses = {};

            allData.forEach(item => {
                const platform = item.platform;
                const classNum = item.class_number;

                platformCounts[platform] = (platformCounts[platform] || 0) + 1;
                classCounts[classNum] = (classCounts[classNum] || 0) + 1;

                if (!platformClasses[platform]) platformClasses[platform] = new Set();
                platformClasses[platform].add(classNum);
            });

            renderStats(allData, platformCounts, classCounts);
            renderPlatformChart(platformCounts);
            renderClassCountChart(classCounts);
            renderPlatformClassesChart(platformClasses);
            initializeTable(allData);
            populateFilters(allData);
        }

        function renderStats(data, platformCounts, classCounts) {
            const statsContainer = document.getElementById('statsContainer');
            const totalContent = data.length;
            const totalClasses = Object.keys(classCounts).filter(k=>k).length;
            const totalPlatforms = Object.keys(platformCounts).filter(k=>k).length;
            const mostCommonClass = Object.keys(classCounts).reduce((a,b)=> classCounts[a] > classCounts[b] ? a : b, Object.keys(classCounts)[0] || '');
            const mostCommonPlatform = Object.keys(platformCounts).reduce((a,b)=> platformCounts[a] > platformCounts[b] ? a : b, Object.keys(platformCounts)[0] || '');

            statsContainer.innerHTML = `
                <div class="stat-box"><div class="stat-number">${totalContent}</div><div class="stat-label">Total de Contenidos</div></div>
                <div class="stat-box"><div class="stat-number">${totalClasses}</div><div class="stat-label">Clases Cubiertas</div></div>
                <div class="stat-box"><div class="stat-number">${totalPlatforms}</div><div class="stat-label">Plataformas</div></div>
                <div class="stat-box"><div class="stat-number">${mostCommonClass}</div><div class="stat-label">Clase MÃ¡s Activa</div></div>
                <div class="stat-box"><div class="stat-number">${mostCommonPlatform}</div><div class="stat-label">Plataforma Principal</div></div>
            `;
        }

        function generateColors(count) {
            const colors = ['rgba(220,20,60,0.7)','rgba(45,80,22,0.7)','rgba(255,215,0,0.7)','rgba(33,150,243,0.7)','rgba(244,67,54,0.7)','rgba(156,39,176,0.7)','rgba(0,188,212,0.7)'];
            const borderColors = colors.map(c => c.replace('0.7','1'));
            const background = [], border = [];
            for (let i=0;i<count;i++){ background.push(colors[i % colors.length]); border.push(borderColors[i % borderColors.length]); }
            return { background, border };
        }

        function renderPlatformChart(counts) {
            const labels = Object.keys(counts).sort();
            const dataValues = labels.map(l => counts[l]);
            const { background, border } = generateColors(labels.length);
            new Chart(document.getElementById('platformChart'), {
                type: 'doughnut',
                data: { labels, datasets: [{ data: dataValues, backgroundColor: background, borderColor: border, borderWidth:2 }] },
                options: { responsive:true, plugins:{ legend:{ labels:{ color:'#E8E8E8', font:{ size:12 } } } } }
            });
        }

        function renderClassCountChart(counts) {
            const entries = Object.entries(counts).map(([k,v])=>({k,v})).sort((a,b)=> b.v - a.v).slice(0,15);
            const labels = entries.map(e=> `Clase ${e.k}`); const dataValues = entries.map(e=> e.v);
            new Chart(document.getElementById('classCountChart'), {
                type:'bar', data:{ labels, datasets:[{ label:'Contenidos', data:dataValues, backgroundColor: generateColors(labels.length).background[0], borderColor: generateColors(labels.length).border[0], borderWidth:1 }] },
                options:{ indexAxis:'y', responsive:true, scales:{ x:{ beginAtZero:true, ticks:{ color:'#E8E8E8' }, grid:{ color:'rgba(255,255,255,0.1)'} }, y:{ ticks:{ color:'#E8E8E8' }, grid:{ color:'rgba(255,255,255,0.1)'} } }, plugins:{ legend:{ display:false } } }
            });
        }

        function renderPlatformClassesChart(platformClasses) {
            const labels = Object.keys(platformClasses).sort();
            const dataValues = labels.map(p => platformClasses[p].size || 0);
            const { background, border } = generateColors(labels.length);
            new Chart(document.getElementById('platformClassesChart'), {
                type:'bar', data:{ labels, datasets:[{ label:'Clases Ãšnicas', data:dataValues, backgroundColor: background, borderColor: border, borderWidth:1 }] },
                options:{ responsive:true, scales:{ y:{ beginAtZero:true, ticks:{ color:'#E8E8E8' }, grid:{ color:'rgba(255,255,255,0.1)' } }, x:{ ticks:{ color:'#E8E8E8' }, grid:{ color:'rgba(255,255,255,0.1)' } } } }
            });
        }

        function initializeTable(data) {
            const tableData = data.map(item => ({ class: item.class_number, title: item.title || 'Sin tÃ­tulo', platform: item.platform, url: item.url, notes: item.notes || '-' }));
            table = new Tabulator("#dataTable", {
                data: tableData,
                layout: "fitColumns",
                pagination: "local",
                paginationSize: 15,
                paginationSizeSelector: [10,15,20,50],
                columns: [
                    { title: "Clase", field: "class", width:80, sorter:"number" },
                    { title: "TÃ­tulo", field: "title", minWidth:250 },
                    { title: "Plataforma", field: "platform", width:130, sorter:"string" },
                    { title: "Enlace", field: "url", width:120, formatter: function(cell){
                        const value = cell.getValue();
                        return value ? `<a href="${encodeURI(value)}" target="_blank" rel="noopener noreferrer">Ver</a>` : '-';
                    }},
                    { title: "Notas", field: "notes", minWidth:150 }
                ],
                initialSort: [{ column: "class", dir: "desc" }]
            });
        }

        function populateFilters(data) {
            const classFilter = document.getElementById('classFilter');
            const classes = [...new Set(data.map(d=>d.class_number))].filter(x=>x).sort((a,b)=> b - a);
            classes.forEach(cls => { const op = document.createElement('option'); op.value = cls; op.textContent = `Clase ${cls}`; classFilter.appendChild(op); });

            const platformFilter = document.getElementById('platformFilter');
            const plats = [...new Set(data.map(d=>d.platform))].sort();
            plats.forEach(p => { const op = document.createElement('option'); op.value = p; op.textContent = p; platformFilter.appendChild(op); });
        }

        function applyFilters() {
            const classValue = document.getElementById('classFilter').value;
            const platformValue = document.getElementById('platformFilter').value;
            const searchValue = document.getElementById('searchInput').value.toLowerCase();
            const filters = [];
            if (classValue) filters.push({ field:"class", type:"=", value: classValue });
            if (platformValue) filters.push({ field:"platform", type:"=", value: platformValue });
            if (searchValue) filters.push({ field:"title", type:"like", value: searchValue });
            table.setFilter(filters);
        }

        function clearFilters() {
            document.getElementById('classFilter').value = '';
            document.getElementById('platformFilter').value = '';
            document.getElementById('searchInput').value = '';
            if (table) table.clearFilter();
        }

        document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>
